<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>.:: Filtro Busqueda ::.</title>

<!-- Mejoras para compatibilidad con bots SITE -->
<style>
    /* Estilos adicionales para mejor reconocimiento */
    .bot-visible {
        visibility: visible !important;
        display: block !important;
        opacity: 1 !important;
    }
    
    .tipo-consulta-wrapper {
        position: relative;
        width: 100%;
    }
    
    .boton-consulta-wrapper {
        position: relative;
        width: 100%;
    }
</style>

</head>

<body>
    <div dojoType="dijit.layout.ContentPane" id="criterios">
        <form id="criterio.form" dojoType="dijit.form.Form" name="lista">
           <input type="hidden" id="action" name="action" value="realizarConsulta" />
           <input type="hidden" id="buscarPor" name="buscarPor" value="porPer" />
           
           <input type="hidden" id="estado" name="estado" value="1" />
           
<table width="100%" >
  <tr align="center">
    <td>
<table width="90%" align="center" class="form-table-2">
  <tr>
    <td>
	
        <table width="100%" class="form-table-2">
          <tr>
            <td class="T1">
            <div align="center">Consultas Factura, Nota de Cr&eacute;dito y D&eacute;bito Electr&oacute;nicas</div>
            </td>
          </tr>
        </table>
        
        <table width="100%" class="form-table-2">

                <tr> 
                  <td  width="30%"  class="beta">Fecha de Inicio  </td>				  
                  <td width="1%" class="beta">:</td>
                  <td width="70%" align="left" class=""> 
                <input type="text" id="criterio.fec_desde" name="fec_desde" size="10" maxlength="10" value="" dojoType="dijit.form.ValidationTextBox" regExp="^(?:(?:0?[1-9]|1\d|2[0-8])(\/|-)(?:0?[1-9]|1[0-2]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:31(\/|-)(?:0?[13578]|1[02]))|(?:(?:29|30)(\/|-)(?:0?[1,3-9]|1[0-2])))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(29(\/|-)0?2)(\/|-)(?:(?:0[48]00|[13579][26]00|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$">
                <a href="javascript:show_calendar('document.lista.fec_desde', document.lista.fec_desde.value);"><img src="/a/imagenes/cal.gif" width="16" height="16" border="0" alt="Fecha (dd/mm/yyyy)"></a>
                 (formato dd/mm/yyyy)</td>
                </tr>
                
<tr> 
                  <td  width="30%"  class="beta">Fecha de Fin</td>				  
                  <td width="1%" class="beta">:</td>
                  <td width="70%" align="left" class=""> 
                <input type="text" id="criterio.fec_hasta" name="fec_hasta" size="10" maxlength="10" value=""  dojoType="dijit.form.ValidationTextBox" regExp="^(?:(?:0?[1-9]|1\d|2[0-8])(\/|-)(?:0?[1-9]|1[0-2]))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(?:(?:31(\/|-)(?:0?[13578]|1[02]))|(?:(?:29|30)(\/|-)(?:0?[1,3-9]|1[0-2])))(\/|-)(?:[1-9]\d\d\d|\d[1-9]\d\d|\d\d[1-9]\d|\d\d\d[1-9])$|^(29(\/|-)0?2)(\/|-)(?:(?:0[48]00|[13579][26]24|[2468][048]00)|(?:\d\d)?(?:0[48]|[2468][048]|[13579][26]))$">
                <a href="javascript:show_calendar('document.lista.fec_hasta', document.lista.fec_hasta.value);"><img src="/a/imagenes/cal.gif" width="16" height="16" border="0" alt="Fecha (dd/mm/yyyy)"></a>
                 (formato dd/mm/yyyy)</td>
                </tr>				
              
              <!-- MEJORAS PARA RECONOCIMIENTO DEL TIPO DE CONSULTA -->
              <tr align="left">
                <td class="beta">Tipo de Consulta </td>
                <td class="beta">:</td>
                <td class="tipo-consulta-wrapper">
                    <!-- Backup tradicional para bots que no soportan Dojo -->
                    <!-- Bot SITE Alternative Selector -->
                    <select id="tipoConsultaBackup" name="tipoConsultaBackup" class="bot-visible" style="display:none; position:absolute; top:0; left:0;">
                        <option value="10" selected="selected">FE Emitidas</option>
                        <option value="11">FE Recibidas</option>
                        <option value="12">FE Rechazadas</option>
                        <option value="13">NC Emitidas</option>
                        <option value="14">NC Recibidas</option>
                        <option value="15">ND Emitidas</option>
                        <option value="16">ND Recibidas</option>
                    </select>
                    
                    <!-- Select original Dojo (mantiene funcionalidad nativa) -->
                    <select id="criterio.tipoConsulta" name="tipoConsulta" dojoType="dijit.form.FilteringSelect" autoComplete="true" class="bot-visible">
                        <option value="10" selected="selected">FE Emitidas</option>
                        <option value="11">FE Recibidas</option>
                        <option value="12">FE Rechazadas</option>
                        <option value="13">NC Emitidas</option>
                        <option value="14">NC Recibidas</option>
                        <option value="15">ND Emitidas</option>
                        <option value="16">ND Recibidas</option>
                    </select>
                    
                    <!-- Backup adicional con atributos específicos para SITE -->
                    <select id="site_tipoConsulta" name="site_tipoConsulta" class="bot-visible" style="display:none; position:absolute; top:0; left:0;" 
                            data-site-visible="true" data-role="select" data-field-type="tipoConsulta">
                        <option value="10" selected="selected">FE Emitidas</option>
                        <option value="11">FE Recibidas</option>
                        <option value="12">FE Rechazadas</option>
                        <option value="13">NC Emitidas</option>
                        <option value="14">NC Recibidas</option>
                        <option value="15">ND Emitidas</option>
                        <option value="16">ND Recibidas</option>
                    </select>
                    
                    <!-- Backup simple sin atributos especiales -->
                    <select id="simple_tipoConsulta" name="simple_tipoConsulta" class="bot-visible" style="display:none; position:absolute; top:0; left:0;">
                        <option value="10" selected="selected">FE Emitidas</option>
                        <option value="11">FE Recibidas</option>
                        <option value="12">FE Rechazadas</option>
                        <option value="13">NC Emitidas</option>
                        <option value="14">NC Recibidas</option>
                        <option value="15">ND Emitidas</option>
                        <option value="16">ND Recibidas</option>
                    </select>
                </td>
              </tr>
            </table>
            
            <table width="100%" class="form-table-2">
              <!-- MEJORAS PARA RECONOCIMIENTO DEL BOTÓN CONSULTA -->
              <tr>
                <td width="40%" align="right" class="boton-consulta-wrapper">
                    <!-- Botón principal Dojo -->
                    <button id="criterio.btnContinuar" dojoType="dijit.form.Button" iconClass="nextIcon" onclick="consultaFactura.realizarConsulta()" class="bot-visible">Aceptar</button>
                    
                    <!-- Backup para bots SITE -->
                    <button id="siteBtnContinuar" name="siteBtnContinuar" onclick="consultaFactura.realizarConsulta()" class="bot-visible" style="display:none; position:absolute; top:0; left:0;" 
                            data-site-visible="true" data-role="button" data-action="realizarConsulta" data-button-type="accept">
                        Aceptar
                    </button>
                    
                    <!-- Backup adicional -->
                    <input type="button" id="backupBtnContinuar" name="backupBtnContinuar" value="Aceptar" onclick="consultaFactura.realizarConsulta()" class="bot-visible" 
                           style="display:none; position:absolute; top:20px; left:0;" data-site-visible="true" data-role="submit">
                    
                    <!-- Backup simple -->
                    <input type="submit" id="simpleBtnContinuar" name="simpleBtnContinuar" value="ACEPTAR" onclick="consultaFactura.realizarConsulta()" class="bot-visible" 
                           style="display:none; position:absolute; top:40px; left:0;" data-site-visible="true">
                           
                </td>
                <td width="1%">&nbsp;</td>
                <td width="18%" align="center">
                    <button id="criterio.btnProceso" dojoType="dijit.form.Button" iconClass="download" disabled="disabled" class="bot-visible">Solicitud de descarga masiva en proceso</button>				
                    <button id="criterio.btnSolicitaDescarga" dojoType="dijit.form.Button" iconClass="download" onclick="consultaFactura.solicitarDescarga()" style="display:none" class="bot-visible">Solicitar descarga Masiva</button>									
                    <button id="criterio.btnDescargar" dojoType="dijit.form.Button" iconClass="download" onclick="consultaFactura.descargarArchivo()" style="display:none" class="bot-visible">Descargar archivo solicitado</button>									
                </td>
                <td width="1%">&nbsp;</td>
                <td width="40%" align="left">
                    <button id="criterio.btnSalir" dojoType="dijit.form.Button" iconClass="deleteIcon" onclick="consultaFactura.salirConsulta()" class="bot-visible">Salir</button>				
                </td>
              </tr>
              <tr>
                <td align="left" colspan="5">&nbsp;
                <div id="mensaje">							
                </div>
                </td>	
              </tr>
            </table>	
    
    
    </td>
  </tr>
</table>	
    </td>
  </tr>
</table>		   

        </form>
    </div>

    <!-- Script para mejorar compatibilidad con bots SITE -->
    <script type="text/javascript">
        // Funciones de sincronización para bots
        function syncTipoConsulta() {
            try {
                // Obtener elemento principal
                var elementoPrincipal = document.getElementById('criterio.tipoConsulta') || 
                                      document.querySelector('select[name="tipoConsulta"]');
                
                // Obtener elementos backup
                var backup1 = document.getElementById('tipoConsultaBackup');
                var backup2 = document.getElementById('site_tipoConsulta');
                var backup3 = document.getElementById('simple_tipoConsulta');
                
                if (elementoPrincipal && backup1) {
                    // Sincronizar valor
                    backup1.value = elementoPrincipal.value;
                    backup2.value = elementoPrincipal.value;
                    backup3.value = elementoPrincipal.value;
                    
                    // Mostrar backup si es necesario
                    if (elementoPrincipal.style.display === 'none' || 
                        elementoPrincipal.style.visibility === 'hidden' ||
                        elementoPrincipal.offsetHeight === 0) {
                        backup1.style.display = 'block';
                        backup2.style.display = 'block';
                        backup3.style.display = 'block';
                    }
                }
            } catch (e) {
                console.log('Error sincronizando tipo consulta:', e);
            }
        }
        
        function syncBotonConsulta() {
            try {
                var botonPrincipal = document.getElementById('criterio.btnContinuar');
                var botonBackup = document.getElementById('siteBtnContinuar');
                var inputBackup = document.getElementById('backup-btnContinuar');
                var submitBackup = document.getElementById('simpleBtnContinuar');
                
                if (botonPrincipal && botonBackup) {
                    // Mostrar backup si es necesario
                    if (botonPrincipal.style.display === 'none' || 
                        botonPrincipal.style.visibility === 'hidden' ||
                        botonPrincipal.offsetHeight === 0) {
                        botonBackup.style.display = 'block';
                        inputBackup.style.display = 'block';
                        submitBackup.style.display = 'block';
                    }
                }
            } catch (e) {
                console.log('Error sincronizando botón consulta:', e);
            }
        }
        
        // Ejecutar sincronización cada 500ms
        setInterval(function() {
            syncTipoConsulta();
            syncBotonConsulta();
        }, 500);
        
        // Ejecutar al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            syncTipoConsulta();
            syncBotonConsulta();
        });
        
        // Función para detectar bots SITE
        function detectaSITE() {
            try {
                var userAgent = navigator.userAgent;
                var isSiteBot = /SITE|bot/i.test(userAgent) || 
                               window.location.search.includes('bot') ||
                               document.referrer.includes('site') ||
                               window.name.includes('site');
                
                if (isSiteBot) {
                    // Mostrar elementos backup para bots SITE
                    var elementosBackup = document.querySelectorAll('[data-site-visible="true"]');
                    elementosBackup.forEach(function(elemento) {
                        elemento.style.display = 'block';
                        elemento.style.visibility = 'visible';
                    });
                    
                    console.log('SITE Bot detectado - Activando elementos backup');
                }
            } catch (e) {
                console.log('Error detectando bot:', e);
            }
        }
        
        // Ejecutar detección
        setTimeout(detectaSITE, 1000);
        
        // Función mejorada para consulta
        function realizarConsultaMejorada() {
            try {
                // Sincronizar valores antes de enviar
                syncTipoConsulta();
                
                // Llamar función original
                if (typeof consultaFactura !== 'undefined' && 
                    typeof consultaFactura.realizarConsulta === 'function') {
                    consultaFactura.realizarConsulta();
                } else {
                    // Backup si no existe la función original
                    var form = document.getElementById('criterio.form');
                    if (form) {
                        form.submit();
                    }
                }
            } catch (e) {
                console.log('Error en consulta mejorada:', e);
                // Backup submit
                var form = document.getElementById('criterio.form');
                if (form) {
                    form.submit();
                }
            }
        }
        
        // Hacer disponible globalmente
        window.realizarConsultaMejorada = realizarConsultaMejorada;
        
    </script>
</body>
</html>
<script id="f5_cspm">(function(){var f5_cspm={f5_p:'OPCALFLCMDJDBKLGNMEMPPMBMAFIPKNNJMMPAAAGACIGCGGMEEMENAMPANOJEJPBCJOBJKDMAAJCGJIMKDMACLKIAADEGMBLIHIDFAODEFAGLHFIALDDEJDGJGPNPOMB',setCharAt:function(str,index,chr){if(index>str.length-1)return str;return str.substr(0,index)+chr+str.substr(index+1);},get_byte:function(str,i){var s=(i/16)|0;i=(i&15);s=s*32;return((str.charCodeAt(i+16+s)-65)<<4)|(str.charCodeAt(i+s)-65);},set_byte:function(str,i,b){var s=(i/16)|0;i=(i&15);s=s*32;str=f5_cspm.setCharAt(str,(i+16+s),String.fromCharCode((b>>4)+65));str=f5_cspm.setCharAt(str,(i+s),String.fromCharCode((b&15)+65));return str;},set_latency:function(str,latency){latency=latency&0xffff;str=f5_cspm.set_byte(str,40,(latency>>8));str=f5_cspm.set_byte(str,41,(latency&0xff));str=f5_cspm.set_byte(str,35,2);return str;},wait_perf_data:function(){try{var wp=window.performance.timing;if(wp.loadEventEnd>0){var res=wp.loadEventEnd-wp.navigationStart;if(res<60001){var cookie_val=f5_cspm.set_latency(f5_cspm.f5_p,res);window.document.cookie='f5avr0797052115aaaaaaaaaaaaaaaa_cspm_='+encodeURIComponent(cookie_val)+';path=/;'+'';}
return;}}
catch(err){return;}
setTimeout(f5_cspm.wait_perf_data,100);return;},go:function(){var chunk=window.document.cookie.split(/\s*;\s*/);for(var i=0;i<chunk.length;++i){var pair=chunk[i].split(/\s*=\s*/);if(pair[0]=='f5_cspm'&&pair[1]=='1234')
{var d=new Date();d.setTime(d.getTime()-1000);window.document.cookie='f5_cspm=;expires='+d.toUTCString()+';path=/;'+';';setTimeout(f5_cspm.wait_perf_data,100);}}}}
f5_cspm.go();}());</script>
